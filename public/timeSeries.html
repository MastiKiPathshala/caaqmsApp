<!DOCTYPE html>
<html lang="en">

<head>
<title>Timeseries Data</title>
  <meta name="author" content="Taniya Datta">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
   <link rel="stylesheet" type="text/css" href="http://weloveiconfonts.com/api/?family=entypo"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
 
  <link rel='stylesheet prefetch' type="text/css" href="css/style.css"/>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script type="text/javascript" src="js/location.js"></script>
<script type="text/javascript">
      $(function(){
        var includes = $('[data-include]');
          jQuery.each(includes, function(){
             var file =$(this).data('include') + '.html';
                $(this).load(file);
    });
  });
  
  </script>
</head>

<body>
<div data-include="header"></div>

      <p id="head" class="caption" style="font-size: 30px;margin-left: 10px;position:absolute;margin-top:50px"><a href="#" onClick="goToViewer()">ID</a></p>
      


<!--Charts-->
<div id="chartContainer" style="height: 300px; width:600px;top:80px;left:10px;position:absolute;margin-top:30px"></div>
<div id="chartContainer1" style="height: 300px; width:600px;top:430px;left:10px;position:absolute;margin-bottom:30px"></div>
<div id="chartContainer2" style="height: 300px; width:600px;top:80px;left:620px;position:absolute;margin-top:30px"></div>
<div id="chartContainer3" style="height: 300px; width:600px;top:430px;left:620px;position:absolute;margin-bottom:30px"></div>
  



<script type="text/javascript">
var deviceId=getItem();
  window.onload = function () {
    

     
    $('#head a').html("Device Id :"+ deviceId);
    
     var gatewayId=getItem();

     CanvasJS.addColorSet("Shades",["green","blue","pink"]);

    //chart.options.data[0].dataPoints.push({y: temp}); // Add a new dataPoint to dataPoints array
 

    var temp_chart= new CanvasJS.Chart("chartContainer",
    { 
      colorSet: "Shades",
      backgroundColor: "rgb(255,255,255)",
      title:{
      text: "Temperature-Sensor Line Chart",  
      fontColor: "black"  
      },
      axisX:{
        title: "Timeline",
        valueFormatString: "DD-MMM HH:mm" ,
         labelAngle: -50,
         gridThickness: 1
    },
    axisY: [{
      stripLines:[
      {                
        startValue:31,
        endValue:32,                
        color:"red"                
      },
      {                
        startValue:12,
        endValue:13,                
        color:"yellow"                
      }
      ]},
      {
        title: "Temperature",
        lineColor: "green",
    },{
      lineColor: "rgb(255,255,255)",
    },
    {
      lineColor: "rgb(255,255,255)",
    }],
      data: [
      {        
        type: "line",
        showInLegend: true,
        legendText: "Temperature",
        dataPoints: [
      
        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MaxTemperature",
        dataPoints: [
      
        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MinTemperature",
        dataPoints: [
      
        ]
      }

      ]
    });

    temp_chart.render();
    //chart.options.data[0].dataPoints.push({x:9,y: temp});
    //temp_chart.options.data[0].dataPoints[0].y = temp; 
   // Update an existing dataPoint
  

	var humid_chart = new CanvasJS.Chart ("chartContainer1", {
		colorSet: "Shades",
		backgroundColor: "rgb(255,255,255)",
		title: {
			text: "Humidity-Sensor Line Chart",
			fontColor: "black"
		},
		axisX: {
			title: "Timeline",
			valueFormatString: "DD-MMM HH:mm" ,
			labelAngle: -50,
			gridThickness: 1
		},
		axisY: [
		{
			stripLines: [
			{
				startValue:81,
				endValue:82,
				color:"red"
			},
			{
				startValue:72,
				endValue:73,
				color:"yellow"
			}
			]
		},
		{
			title: "Humidity",
			lineColor: "green"
		},
		{
			lineColor: "rgb(255,255,255)"
		},
		{
			lineColor: "rgb(255,255,255)"
		}
		],
		data: [
		{
			type: "line",
			showInLegend: true,
			legendText: "AvgHumidity",
			dataPoints: [
			]
		},
		{
			type: "line",
			showInLegend: true,
			legendText: "MaxHumidity",
			dataPoints: [
			]
		},
		{
			type: "line",
			showInLegend: true,
			legendText: "MinHumidity",
			dataPoints: [
			]
		}
		]
	});
	humid_chart.render();
    

    var so2_chart = new CanvasJS.Chart("chartContainer2",
    {
      colorSet: "Shades",
      backgroundColor: "rgb(255,255,255)",
      title:{
      text: "SO2-Sensor Line Chart",  
      fontColor: "black"  
      },
      axisX:{
        title: "Timeline", 
        valueFormatString: "DD-MMM HH:mm" ,
         labelAngle: -50,
        gridThickness: 1
    },
    axisY: [{
      stripLines:[
      {                
        startValue:31,
        endValue:32,                
        color:"red"                
      },
      {                
        startValue:12,
        endValue:13,                
        color:"yellow"                
      }
      ]},
      {
        title: "SO2",
      lineColor: "green",
    },{
      lineColor: "rgb(255,255,255)",
    },
    {
      lineColor: "rgb(255,255,255)",
    }],
      data: [
      {        
        type: "line",
        showInLegend: true,
        legendText: "SO2",
        dataPoints: [

        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MaxSO2",
        dataPoints: [

        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MinSO2",
        dataPoints: [

        ]
      }       
      ]
    });

    so2_chart.render();

  
  var no2_chart = new CanvasJS.Chart("chartContainer3",
    {
      colorSet: "Shades",
      backgroundColor: "rgb(255,255,255)",
      title:{
      text: "NO2-Sensor Line Chart",  
      fontColor: "black"
      },
      axisX:{
        title: "Timeline",
         valueFormatString: "DD-MMM HH:mm" ,
         labelAngle: -50,
        gridThickness: 1
    },
    axisY: [{
      stripLines:[
      {                
        startValue:31,
        endValue:32,                
        color:"red"                
      },
      {                
        startValue:12,
        endValue:13,                
        color:"yellow"                
      }
      ]},{
        title: "NO2",
    lineColor: "green",
    },{
      lineColor: "rgb(255,255,255)",
    },
    {
      lineColor: "rgb(255,255,255)",
    }],
      data: [
      {        
        type: "line",
        showInLegend: true,
        legendText: "NO2",
        dataPoints: [
      
        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MaxNO2",
        dataPoints: [
      
        ]
      },
      {        
        type: "line",
        showInLegend: true,
        legendText: "MinNO2",
        dataPoints: [
      
        ]
      }       
      ]
    });

    no2_chart.render();

    $.ajax({
  method: 'GET',
  url: '/api/alerts/v1.0/getRule/'+deviceId
 }).done(function(data) {

  if  (data.status === "OK") {
   console.log(data.results);
    for(var i in data.results)
    {
      if(data.results[i].dataType=='temperature')
      { 
          temp_chart.options.axisY[0].stripLines[0].startValue=data.results[i].rThreshold-1;
          temp_chart.options.axisY[0].stripLines[0].endValue=data.results[i].rThreshold+1;
          temp_chart.options.axisY[0].stripLines[1].startValue=data.results[i].yThreshold-1;
          temp_chart.options.axisY[0].stripLines[1].endValue=data.results[i].yThreshold+1;
      }
      if(data.results[i].dataType=='humidity')
      {
          humid_chart.options.axisY[0].stripLines[0].startValue=data.results[i].rThreshold-1;
          humid_chart.options.axisY[0].stripLines[0].endValue=data.results[i].rThreshold+1;
          humid_chart.options.axisY[0].stripLines[1].startValue=data.results[i].yThreshold-1;
          humid_chart.options.axisY[0].stripLines[1].endValue=data.results[i].yThreshold+1;
      }
      if(data.results[i].dataType=='so2')
      {
          so2_chart.options.axisY[0].stripLines[0].startValue=data.results[i].rThreshold-1;
          so2_chart.options.axisY[0].stripLines[0].endValue=data.results[i].rThreshold+1;
          so2_chart.options.axisY[0].stripLines[1].startValue=data.results[i].yThreshold-1;
          so2_chart.options.axisY[0].stripLines[1].endValue=data.results[i].yThreshold+1;
      }
      if(data.results[i].dataType=='no2')
      {
          no2_chart.options.axisY[0].stripLines[0].startValue=data.results[i].rThreshold-1;
          no2_chart.options.axisY[0].stripLines[0].endValue=data.results[i].rThreshold+1;
          no2_chart.options.axisY[0].stripLines[1].startValue=data.results[i].yThreshold-1;
          no2_chart.options.axisY[0].stripLines[1].endValue=data.results[i].yThreshold+1;
      }
    }
      temp_chart.render();
      humid_chart.render();
      so2_chart.render();
      no2_chart.render();
    
  } else {
   //alert(data.results);
   
  }
  
 }).fail(function(data) {
  console.log (data);
 });


 $.ajax({
  method: 'GET',
  url: '/api/sensorData/v1.0/temperature/'+deviceId
 }).done(function(data) {

  if  (data.status === "OK") {
    console.log(data.results);
    for(var i in data.results)
    {
      	 
          temp_chart.options.data[0].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].avgTemperature});
          temp_chart.options.data[1].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].maxTemperature});
          temp_chart.options.data[2].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].minTemperature});
    	  console.log(data.results[i].avgTemperature);
    }
    temp_chart.render(); 
    
  } else {
   //alert(data.results);
   
  }
  
 }).fail(function(data) {
  console.log (data);
 });
 $.ajax({
  method: 'GET',
  url: '/api/sensorData/v1.0/humidity/'+deviceId
 }).done(function(data) {

  if  (data.status === "OK") {
    console.log(data.results);
    for(var i in data.results)
    {
         
          humid_chart.options.data[0].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].avgHumidity});
          humid_chart.options.data[1].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].maxHumidity});
          humid_chart.options.data[2].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].minHumidity});
    
    }
    humid_chart.render(); 
    
  } else {
   //alert(data.results);
   
  }
  
 }).fail(function(data) {
  console.log (data);
 });
 $.ajax({
  method: 'GET',
  url: '/api/sensorData/v1.0/so2/'+deviceId
 }).done(function(data) {

  if  (data.status === "OK") {
    console.log(data.results);
    for(var i in data.results)
    {
      
          
          so2_chart.options.data[0].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].avgSo2});
          so2_chart.options.data[1].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].maxSo2});
          so2_chart.options.data[2].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].minSo2});
    
    }
    so2_chart.render(); 
    
  } else {
   //alert(data.results);
   
  }
  
 }).fail(function(data) {
  console.log (data);
 });
 $.ajax({
  method: 'GET',
  url: '/api/sensorData/v1.0/no2/'+deviceId
 }).done(function(data) {

  if  (data.status === "OK") {
    console.log(data.results);
    for(var i in data.results)
    {
      
          no2_chart.options.data[0].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].avgNo2});
          no2_chart.options.data[1].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].maxNo2});
          no2_chart.options.data[2].dataPoints.push({x:new Date(data.results[i].time),y: data.results[i].minNo2});
    
    }
    no2_chart.render(); 
    
  } else {
   //alert(data.results);
   
  }
  
 }).fail(function(data) {
  console.log (data);
 });
  
}
       
     function goToViewer()
       {  
           window.localStorage.setItem('gateway',deviceId);
           window.location.href="analytics.html";

       }
  </script>

  <script type="text/javascript" src="js/canvasjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.17/vue.js"></script>


<div data-include="footer"></div>
</body>

</html>
